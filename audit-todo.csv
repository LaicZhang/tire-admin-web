ID,Priority,Category,Area,Title,Finding,Recommendation,HowToVerify,Evidence,Effort,Status
1,P0,Runtime/Security,"src/utils/http/index.ts; src/utils/auth.ts","Token 无感刷新可能死锁/请求挂起","请求拦截白名单与实际接口不匹配，且 getToken 优先返回 cookie 导致 refreshToken 缺失；refresh 失败时仅清空队列未 resolve/reject，等待中的请求可能永久挂起。","1) whiteList 改为匹配实际接口（如 /api/auth/login、/api/auth/refresh-token），或新增 config.skipAuth 跳过拦截；2) getToken 合并 cookie(accessToken/expires) 与 localStorage(refreshToken/用户信息)；3) 队列改为保存 resolve/reject，refresh 失败时 reject 并统一登出；4) 为过期/失败分支补充单测。","过期 token 调用任意接口：自动刷新并继续；refresh 失败：请求快速失败且跳转登录；pnpm test/pnpm typecheck 通过。","src/utils/http/index.ts:126; src/utils/auth.ts:23",M,TODO
2,P0,TypeScript,"src/views/business/order/**","修复订单模块 TypeScript 编译错误（阻塞 pnpm typecheck）","订单模块存在大量 TS 编译错误（隐式 any、DTO 不匹配、PaginatedResponseDto 当数组用等），导致 pnpm typecheck 失败。","按文件拆分修复：先让类型检查通过（显式参数类型/修正泛型/修正可空），再收敛 any；同时对齐前后端 DTO。","pnpm typecheck 通过；相关页面可正常构建与运行。","pnpm typecheck 统计：order/table.tsx(23), order/props/sale.tsx(17), order/props/purchase.tsx(14)...",L,TODO
3,P0,Bug/TypeScript,src/views/business/order/composables/useOrderData.ts,"修正订单页面基础数据加载与缓存结构","useOrderData 将 CommonResult<PaginatedResponseDto<T>> 的 data 直接当成数组使用，并且 getAllCustomerList 误调用 getTireListApi；会造成类型错误与数据结构不一致。","1) 统一使用 data.list 赋值与缓存；2) 客户列表改为 getCustomerListApi；3) 为各列表增加明确类型（Employee/Repo/Tire/Customer/Provider 等）；4) 可选：缓存增加 TTL，避免数据长期过期。","订单页基础下拉数据正确显示；pnpm typecheck 对此文件无报错。","src/views/business/order/composables/useOrderData.ts:24-80",M,TODO
4,P0,TypeScript,src/views/business/order/handleData.ts,"为 getColumns/getFormRules 等提供可推导类型","handleData.ts 中 orderType/curData 未显式类型导致隐式 any 与索引错误（TS7053）。","1) 将 orderType 类型约束为 ORDER_TYPE 的联合或 keyof map；2) 为 getCommonData 的 curData 提供最小必要类型；3) 让 columnsMap/formRulesMap 的索引可被 TS 校验。","pnpm typecheck 对 handleData.ts 无报错；orderType 传参在调用处可获得类型提示。","src/views/business/order/handleData.ts:23-74",S,TODO
5,P0,TypeScript,"src/views/business/order/props/*.tsx","补齐表格列 formatter/cellRenderer 参数类型","多个 props/*.tsx 文件中 formatter 参数（row/column/cellValue 等）为隐式 any（TS7006）。","为回调参数补齐类型（可先用 any 或从 @pureadmin/table 的列定义类型推导），保证 noImplicitAny 下可编译。","pnpm typecheck 对 props 目录无报错。","pnpm typecheck 统计：order/props/* 共 80+ 错误",M,TODO
6,P0,API Contract,"src/api/business/order.ts; src/views/business/order/table.tsx","对齐订单相关 DTO 与实际请求体结构","UI 在 addOrderApi/updateOrderApi/pay* 等调用中传入 order/company/connect/fee 等字段，但 DTO 类型定义为 providerId/customerId/total 等，导致 TS2353/TS2322 等错误，也容易掩盖真实后端契约差异。","与后端接口契约对齐后做二选一：A) 调整 UI 请求体使其符合现有 DTO；B) 调整 DTO 类型使其精确表达当前实际请求体（含 connect 结构/字段命名 fee vs total）。随后统一复用类型（避免重复定义）。","pnpm typecheck 通过；相关下单/审核/付款/确认到货等操作请求体与后端一致。","src/views/business/order/table.tsx:90-210; src/api/business/order.ts:1-120",L,TODO
7,P0,TypeScript,src/views/business/tire/table.tsx,"修复轮胎模块 TypeScript 编译错误","tire/table.tsx 存在 formRef 可空、delete 非可选属性、DTO 字段(company)不匹配、参数可能为 undefined 等问题，导致 pnpm typecheck 失败。","1) 处理可空 ref（可选链或提前 return）；2) 调整被 delete 的字段为可选或改用解构排除；3) 对齐 TireDto 与实际提交字段；4) 收紧/转换可能为 undefined 的参数。","pnpm typecheck 对 tire/table.tsx 无报错。","pnpm typecheck 统计：tire/table.tsx(7)",M,TODO
8,P0,TypeScript,"src/views/business/tireNumber/*; src/views/business/warehouseManagement/table.tsx","修复轮胎编号/仓库管理相关 TypeScript 编译错误","tireNumber 与 warehouseManagement 中存在隐式 any、DTO 字段不匹配、参数可能 undefined 等问题，导致 pnpm typecheck 失败。","补齐回调参数类型；对齐 TireNumberDto/RepoDto 等提交字段；处理可空/undefined 分支。","pnpm typecheck 对相关文件无报错。","pnpm typecheck 统计：tireNumber/columns.ts(6), tireNumber/table.tsx(5), warehouseManagement/table.tsx(4)",M,TODO
9,P1,CodeStyle,"src/components/ReDialog/index.vue; src/components/ReIcon/src/iconifyIconOffline.ts; src/layout/components/setting/index.vue; src/layout/components/tag/index.vue; src/views/analysis/assets/index.vue","修复 Prettier 格式错误以通过 ESLint","eslint 运行时存在 prettier/prettier 错误（7 个），会导致 pnpm exec eslint 失败。","对上述文件执行格式修复（优先用 prettier/eslint --fix），并在 CI/本地确保不再引入格式差异。","pnpm exec eslint 通过（无 error）。","pnpm exec eslint 输出：7 errors, 38 warnings",S,TODO
10,P1,Performance,src/layout/components/sidebar/sidebarItem.vue,"移除浏览器端 path polyfill 依赖","sidebarItem.vue 使用 path.posix.resolve 拼接路由路径，引入了 path(0.12.7) 浏览器 polyfill，可能增加 bundle 体积。","用轻量的路径拼接替代（确保处理 / 与 basePath），并移除 package.json 中的 path 依赖（仅该处使用）。","构建产物不再包含 path polyfill；菜单跳转路径行为一致。","src/layout/components/sidebar/sidebarItem.vue:1-63",S,TODO
11,P1,Build/DX,build/plugins.ts,"将 codeInspectorPlugin 限制为开发环境启用","codeInspectorPlugin 当前无条件启用，可能对生产构建体积/安全造成影响。","根据 mode 或 vite 的 apply 选项仅在 dev(serve) 启用。","生产构建产物不包含 inspector 相关代码；开发环境仍可用。","build/plugins.ts:32-49",S,TODO
12,P1,Build/DX,build/plugins.ts,"将 removeConsole 限制为生产构建启用","removeConsole 当前始终启用，可能影响开发调试体验，且与实际“仅线上删除”意图不一致。","仅在 build/production 时启用（或通过 env 控制）；必要时保留 error/warn。","dev 环境 console 可用；生产构建按策略移除 console。","build/plugins.ts:65-66",S,TODO
13,P2,Build/Perf,vite.config.ts,"重新校准 chunkSizeWarningLimit 与包体监控策略","chunkSizeWarningLimit 设为 2000（默认 500）会降低对大 chunk 的预警敏感度，且注释描述与配置不一致。","明确目标阈值（如 600~900），并在 report/CI 中关注最大 chunk；必要时按路由拆分与动态加载优化。","vite build 时能及时提示异常大 chunk；包体可控。","vite.config.ts:31-49",S,TODO
14,P2,Performance,"src/views/analysis/**","优化 ECharts 引入方式以降低页面 chunk 体积","多个分析页使用 `import * as echarts from \"echarts\"`，会引入完整包；welcome/SalesChart 已采用动态 import 示例。","优先复用动态 import 或改用 echarts/core 按需注册（统一封装 getEcharts）；确保 onUnmounted dispose。","分析页路由 chunk 体积下降；功能不变。","rg \"import * as echarts\" 命中：src/views/analysis/**",M,TODO
15,P2,Security,src/utils/auth.ts,"评估 refreshToken 存储策略（localStorage 风险）","refreshToken 存在 localStorage（XSS 下可被读取），虽有 sameSite cookie 缓解 CSRF，但无法防御 XSS 窃取 refreshToken。","与后端配合：考虑使用 httpOnly + secure cookie 存储 refreshToken；前端只持有短期 accessToken（或完全 cookie 化）。","安全评审通过；Token 泄露面降低。","src/utils/auth.ts:70-107",L,TODO
16,P2,Security/Robustness,src/utils/print.ts,"打印工具避免 doc.write/innerHTML 及对原 DOM 的副作用","print.ts 通过 outerHTML/doc.write/innerHTML 组装内容，且会修改原页面 input/textarea/select 属性，存在副作用与潜在注入风险。","改为 cloneNode 深拷贝待打印 DOM，使用 iframe.srcdoc 或更安全的写入方式；对动态内容做最小化白名单处理。","打印后原页面表单状态不被污染；安全评审通过。","src/utils/print.ts:86-160",M,TODO
17,P2,Security/Build,build/cdn.ts,"CDN 外链方案增加完整性与降级策略","CDN 模式使用 bootcdn 且无 SRI/降级策略；在网络受限或 CDN 不可用时可能白屏。","为外链增加 SRI（如可行）与本地 fallback；或仅在受控环境开启 CDN；同时明确运行环境约束。","开启 VITE_CDN 时仍可稳定加载；故障可自动回退。","build/cdn.ts:1-60",M,TODO
18,P2,DX,package.json,"增加非修复型 lint 脚本用于 CI","当前 lint 脚本包含 --fix/--write，CI 或只读环境下不适合直接修改文件。","新增 lint:check（eslint/prettier/stylelint 仅检查不修复），CI 使用 lint:check；本地保留 lint:fix。","CI 具备稳定、无副作用的检查命令。","package.json scripts: lint:*",S,TODO
19,P2,Security/DX,CI/Docs,"引入依赖漏洞扫描（pnpm audit 或替代方案）","当前审计未包含依赖漏洞信息（需联网获取 advisory）。","在 CI 中加入 pnpm audit（或使用 SCA 工具），并将高危漏洞纳入修复节奏。","CI 能输出依赖漏洞清单并阻断高危。","需要网络与 registry 访问",M,TODO
20,P2,Routing,src/router/index.ts,"优化登录白名单判断，避免带 query 时逻辑偏差","已登录状态下 toCorrectRoute 使用 whiteList.includes(to.fullPath) 判断，若登录页带 query（如 /login?redirect=...）可能无法命中。","改用 to.path 进行白名单判断；同时统一 whiteList 的使用方式（fullPath vs path）。","已登录访问 /login 或 /login?xx 均被正确拦截并回跳。","src/router/index.ts:155-157",S,TODO
21,P2,Data Caching,"src/utils/localforage/**; src/views/**","为本地缓存数据增加 TTL 与失效策略","多处将“全量列表”写入 localForage 但无过期时间，可能导致数据长期陈旧或占用较大存储。","对易变化的数据（员工/仓库/客户/供应商等）设置合理 TTL（如 10~60 分钟）并在关键操作后主动刷新。","长时间运行后数据仍可自动更新；缓存空间可控。","src/utils/localforage/index.ts:18-80; useOrderData 等处",M,TODO
22,P2,Observability,src/views/**,"生产环境错误可见性改进（避免只 console.error）","多处使用 console.error 记录失败，但生产构建会移除 console，导致问题定位困难且用户缺少反馈。","建立统一错误处理/上报（最小化：message 提示 + 可选远程上报）；关键请求失败给出可操作提示。","生产环境出现错误时仍有可观测性与用户反馈。","rg \"console.error\" src/views | head",M,TODO
23,P2,CodeQuality,src/config/index.ts,"getPlatformConfig 抛错方式与错误提示优化","getPlatformConfig catch 中 throw 字符串，缺少 Error 栈信息且难以统一处理。","改为 throw new Error(...) 并在入口处捕获展示友好提示（或提供默认 config 回退）。","缺失配置文件时：有明确错误提示与可恢复路径。","src/config/index.ts:33-55",S,TODO
